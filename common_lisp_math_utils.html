<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="mahmood sheikh" />
<meta name="generator" content="Org Mode" />
<title>common lisp math utils</title><!-- lambda icon, frail attempt -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%221em%22 font-size=%22100%22 color=%22red%22>Î»</text></svg>">
<!-- not-so-awesome awesome font -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="/main.css">
<!-- for dark mode -->
<script src="darkmode.js"></script>
<script src="search.js"></script>
<script src="main.js"></script>
</head>
<body>
<div id="preamble" class="status">
<div class="navbar">
  <a href='/'>home</a>
  <a href='/blog.html'>blog</a>
  <a href='/search.html'>search</a>
  <a href='/about.html'>about</a>
  <div id="darkModeToggle" onclick="toggleDarkMode()">
    &#9680; <!-- Circle with left half black -->
  </div>
</div><h1 class="main-title">common lisp math utils</h1>
</div>
<div id="content" class="content">
<p>
some math utilities for <a href="/common_lisp.html#1677249560">common lisp</a><br />
</p>
<div id="outline-container-orgca41f9a" class="outline-2">
<h2 id="orgca41f9a">essential functions</h2>
<div class="outline-text-2" id="text-orgca41f9a">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp" id="src-math-functions"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">sigmoid</span> <span style="color: #837486;">(</span>x<span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">cond</span> <span style="color: #9C6F68;">(</span><span style="color: #7B665C;">(</span>&lt; x -70<span style="color: #7B665C;">)</span> 0<span style="color: #9C6F68;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">to avoid float overflow</span>
        <span style="color: #9C6F68;">(</span>t <span style="color: #7B665C;">(</span>/ 1 <span style="color: #5C7E81;">(</span>1+ <span style="color: #837486;">(</span>exp <span style="color: #9C6F68;">(</span>- x<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">sigmoid-derivative</span> <span style="color: #837486;">(</span>x<span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>* <span style="color: #9C6F68;">(</span>sigmoid x<span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>- 1 <span style="color: #7B665C;">(</span>sigmoid x<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">relu</span> <span style="color: #837486;">(</span>x<span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>max x 0<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">relu-derivative</span> <span style="color: #837486;">(</span>x<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"derivative of relu is undefined at x=0, but here we return 0 for x=0 too"</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">if</span> <span style="color: #9C6F68;">(</span>&gt; x 0<span style="color: #9C6F68;">)</span>
      1
      0<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org3b3da3f" class="outline-2">
<h2 id="org3b3da3f">vectors</h2>
<div class="outline-text-2" id="text-org3b3da3f">
<div class="math-block note" data-before="note" data-after="">
<p>
these functions work, but some use lists and some do redundant operations, they need efficiency improvement<br />
</p>

</div>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp" id="src-vector"><span style="color: #928374;">;; </span><span style="color: #928374;">this might need efficiency improvement, not sure</span>
<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">vector-add</span> <span style="color: #837486;">(</span>vec1 <span style="color: #66999D;">&amp;rest</span> more-vecs<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"apply vector addition to two collections"</span>
  <span style="color: #837486;">(</span>apply #'map <span style="color: #9C6F68;">(</span>append <span style="color: #7B665C;">(</span>list 'vector #'+<span style="color: #7B665C;">)</span> <span style="color: #7B665C;">(</span>append <span style="color: #5C7E81;">(</span>list vec1<span style="color: #5C7E81;">)</span> more-vecs<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #928374;">;; </span><span style="color: #928374;">this definitely needs efficiency improvement, we can just subtract instead of negating vectors then adding them</span>
<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">vector-sub</span> <span style="color: #837486;">(</span>vec1 <span style="color: #66999D;">&amp;rest</span> more-vecs<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"substract each vector in more-vecs from vec1"</span>
  <span style="color: #837486;">(</span>apply #'vector-add
         <span style="color: #9C6F68;">(</span>append <span style="color: #7B665C;">(</span>list vec1<span style="color: #7B665C;">)</span>
                 <span style="color: #7B665C;">(</span>map 'list
                      <span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">lambda</span> <span style="color: #837486;">(</span>vec2<span style="color: #837486;">)</span>
                        <span style="color: #837486;">(</span>map 'vector #'- vec2<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
                      more-vecs<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">vector-dot</span> <span style="color: #837486;">(</span>vec1 vec2<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"dot product"</span>
  <span style="color: #837486;">(</span>reduce #'+ <span style="color: #9C6F68;">(</span>map 'vector #'* vec1 vec2<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">vector-mul</span> <span style="color: #837486;">(</span>vec1 scalar<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"multiply vectors elements by scalar"</span>
  <span style="color: #837486;">(</span>map 'vector <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">lambda</span> <span style="color: #7B665C;">(</span>num<span style="color: #7B665C;">)</span> <span style="color: #7B665C;">(</span>* num scalar<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span> vec1<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">vector-sum</span> <span style="color: #837486;">(</span>vec1 <span style="color: #66999D;">&amp;rest</span> more-vecs<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"sum of vectors elements"</span>
  <span style="color: #837486;">(</span>reduce #'+ <span style="color: #9C6F68;">(</span>map
               'vector
               <span style="color: #7B665C;">(</span><span style="color: #DD6F48;">lambda</span> <span style="color: #5C7E81;">(</span>vec2<span style="color: #5C7E81;">)</span> <span style="color: #5C7E81;">(</span>reduce #'+ vec2<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
               <span style="color: #7B665C;">(</span>append <span style="color: #5C7E81;">(</span>list vec1<span style="color: #5C7E81;">)</span> more-vecs<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">vector-elements-prod</span> <span style="color: #837486;">(</span>vec<span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>reduce #'* vec<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org10ee4b3" class="outline-2">
<h2 id="org10ee4b3">matrices</h2>
<div class="outline-text-2" id="text-org10ee4b3">
<p>
im using arrays for matrices, which use different functions than vectors/lists<br />
matrix multiplication:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp" id="src-matrix-mul"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">matrix-mul</span> <span style="color: #837486;">(</span>arr1 arr2<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"multiply 2 matrices, arr1*arr2"</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">let*</span> <span style="color: #9C6F68;">(</span><span style="color: #7B665C;">(</span>arr1-rows <span style="color: #5C7E81;">(</span>array-rows arr1<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
         <span style="color: #928374;">;; </span><span style="color: #928374;">(arr1-cols (car (cdr arr1-dim))) ;; no need</span>
         <span style="color: #7B665C;">(</span>arr2-rows <span style="color: #5C7E81;">(</span>array-rows arr2<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
         <span style="color: #7B665C;">(</span>arr2-cols <span style="color: #5C7E81;">(</span>array-cols arr2<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
         <span style="color: #7B665C;">(</span>out-arr <span style="color: #5C7E81;">(</span>make-array <span style="color: #837486;">(</span>list arr1-rows arr2-cols<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
    <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">loop</span> for arr1-row from 0 below arr1-rows
          do <span style="color: #7B665C;">(</span><span style="color: #DD6F48;">loop</span> for arr2-col from 0 below arr2-cols
                   do <span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #837486;">(</span><span style="color: #9C6F68;">(</span>sum 0<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
                        <span style="color: #837486;">(</span><span style="color: #DD6F48;">loop</span> for i from 0 below arr2-rows
                              do <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">let*</span> <span style="color: #7B665C;">(</span><span style="color: #5C7E81;">(</span>cell1 <span style="color: #5C7E81;">(</span>aref arr1 arr1-row i<span style="color: #5C7E81;">)</span><span style="color: #5C7E81;">)</span>
                                        <span style="color: #5C7E81;">(</span>cell2 <span style="color: #5C7E81;">(</span>aref arr2 i arr2-col<span style="color: #5C7E81;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
                                   <span style="color: #7B665C;">(</span>incf sum <span style="color: #5C7E81;">(</span>* cell1 cell2<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
                        <span style="color: #837486;">(</span>setf <span style="color: #9C6F68;">(</span>aref out-arr arr1-row arr2-col<span style="color: #9C6F68;">)</span> sum<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
    out-arr<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp" id="src-tensor-convolution"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">tensor-convolution-size</span> <span style="color: #837486;">(</span>img-dims ker-dims<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"return the expected size of the convolution img*ker"</span>
  <span style="color: #837486;">(</span>mapcar <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">lambda</span> <span style="color: #7B665C;">(</span>img-d ker-d<span style="color: #7B665C;">)</span> <span style="color: #7B665C;">(</span>- img-d <span style="color: #5C7E81;">(</span>1- ker-d<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
          img-dims
          ker-dims<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">tensor-convolution</span> <span style="color: #837486;">(</span>img ker<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"convolve two tensors of any ranks/dimensions</span>
<span style="color: #528B8B;">example usage: (tensor-convolution #(1 2 3 4 5) #(6 7))"</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #9C6F68;">(</span><span style="color: #7B665C;">(</span>ker-dims <span style="color: #5C7E81;">(</span>array-dimensions ker<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
        <span style="color: #7B665C;">(</span>img-dims <span style="color: #5C7E81;">(</span>array-dimensions img<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
    <span style="color: #928374;">;; </span><span style="color: #928374;">need to make ker-dims,out-dims same rank/order as img-dims</span>
    <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">loop</span> while <span style="color: #7B665C;">(</span>&lt; <span style="color: #5C7E81;">(</span>length ker-dims<span style="color: #5C7E81;">)</span> <span style="color: #5C7E81;">(</span>length img-dims<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
          do <span style="color: #7B665C;">(</span>push 1 ker-dims<span style="color: #7B665C;">)</span>
             <span style="color: #7B665C;">(</span>setf ker <span style="color: #5C7E81;">(</span>make-array ker-dims <span style="color: #FE8019;">:displaced-to</span> ker<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
    <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #7B665C;">(</span><span style="color: #5C7E81;">(</span>out <span style="color: #837486;">(</span>make-array <span style="color: #9C6F68;">(</span>tensor-convolution-size img-dims ker-dims<span style="color: #9C6F68;">)</span>
                           <span style="color: #FE8019;">:initial-element</span> 0<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
      <span style="color: #7B665C;">(</span>tensor-convolution-util img ker out nil nil <span style="color: #5C7E81;">(</span>array-dimensions out<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
      out<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">tensor-convolution-util</span> <span style="color: #837486;">(</span>img ker out
                                img-indicies out-indicies
                                out-dims<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"this util function for tensor-convolution assumes img,ker,out are all of the same rank/order"</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">if</span> out-dims
      <span style="color: #928374;">;; </span><span style="color: #928374;">iterate through each cell in the output tensor</span>
      <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">loop</span> for out-i from 0 below <span style="color: #7B665C;">(</span>car out-dims<span style="color: #7B665C;">)</span>
            <span style="color: #928374;">;; </span><span style="color: #928374;">iterate through each kernel-sized block in the input tensor</span>
            <span style="color: #928374;">;; </span><span style="color: #928374;">(length img-indicies) gives us the index of the dimension we're at</span>
            do <span style="color: #7B665C;">(</span><span style="color: #DD6F48;">loop</span> for img-i from out-i below <span style="color: #5C7E81;">(</span>+ out-i
                                                   <span style="color: #837486;">(</span>array-dimension
                                                    ker
                                                    <span style="color: #9C6F68;">(</span>length img-indicies<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
                     do <span style="color: #5C7E81;">(</span>tensor-convolution-util
                         img
                         ker
                         out
                         <span style="color: #837486;">(</span>append img-indicies <span style="color: #9C6F68;">(</span>list img-i<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
                         <span style="color: #837486;">(</span>append out-indicies <span style="color: #9C6F68;">(</span>list out-i<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
                         <span style="color: #837486;">(</span>cdr out-dims<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
      <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">let*</span> <span style="color: #7B665C;">(</span><span style="color: #5C7E81;">(</span>img-cell <span style="color: #837486;">(</span>apply #'aref <span style="color: #9C6F68;">(</span>cons img img-indicies<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
             <span style="color: #5C7E81;">(</span>flipped-kernel-indicies <span style="color: #837486;">(</span>mapcar #'-
                                              <span style="color: #9C6F68;">(</span>mapcar #'1- <span style="color: #7B665C;">(</span>array-dimensions ker<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
                                              <span style="color: #9C6F68;">(</span>mapcar #'- img-indicies out-indicies<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
             <span style="color: #5C7E81;">(</span>ker-cell <span style="color: #837486;">(</span>apply #'aref <span style="color: #9C6F68;">(</span>cons ker flipped-kernel-indicies<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
        <span style="color: #7B665C;">(</span>incf <span style="color: #5C7E81;">(</span>apply #'aref <span style="color: #837486;">(</span>cons out out-indicies<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #5C7E81;">(</span>* img-cell ker-cell<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
<div id="outline-container-orgf30dcdf" class="outline-3">
<h3 id="orgf30dcdf">matrix multiplication implementation comparison between lists and arrays</h3>
<div class="outline-text-3" id="text-orgf30dcdf">
<p>
with lists:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>time
 <span style="color: #837486;">(</span><span style="color: #DD6F48;">progn</span>
   <span style="color: #9C6F68;">(</span>matrix-multiplication
    <span style="color: #7B665C;">(</span>make-list 200 <span style="color: #FE8019;">:initial-element</span> <span style="color: #5C7E81;">(</span>make-list 300 <span style="color: #FE8019;">:initial-element</span> 10<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">200x300</span>
    <span style="color: #7B665C;">(</span>make-list 300 <span style="color: #FE8019;">:initial-element</span> <span style="color: #5C7E81;">(</span>make-list 200 <span style="color: #FE8019;">:initial-element</span> 20<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">300x200</span>
   10<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">to prevent repl from printing</span>
<span style="color: #928374;">;; </span><span style="color: #928374;">Evaluation took:</span>
<span style="color: #928374;">;;   </span><span style="color: #928374;">4.010 seconds of real time</span>
<span style="color: #928374;">;;   </span><span style="color: #928374;">4.007356 seconds of total run time (4.007356 user, 0.000000 system)</span>
<span style="color: #928374;">;;   </span><span style="color: #928374;">99.93% CPU</span>
<span style="color: #928374;">;;   </span><span style="color: #928374;">10,006,237,672 processor cycles</span>
<span style="color: #928374;">;;   </span><span style="color: #928374;">1,625,600 bytes consed</span>

<span style="color: #928374;">;; </span><span style="color: #928374;">10 (4 bits, #xA, #o12, #b1010)</span>
</pre>
</div>
<p>
with arrays:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>time
 <span style="color: #837486;">(</span><span style="color: #DD6F48;">progn</span>
   <span style="color: #9C6F68;">(</span>matrix-mul
    <span style="color: #7B665C;">(</span>make-array '<span style="color: #5C7E81;">(</span>350 200<span style="color: #5C7E81;">)</span> <span style="color: #FE8019;">:initial-element</span> 10<span style="color: #7B665C;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">200x300</span>
    <span style="color: #7B665C;">(</span>make-array '<span style="color: #5C7E81;">(</span>200 300<span style="color: #5C7E81;">)</span> <span style="color: #FE8019;">:initial-element</span> 20<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>  <span style="color: #928374;">;; </span><span style="color: #928374;">300x200</span>
   10<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>  <span style="color: #928374;">;; </span><span style="color: #928374;">to prevent repl from printing</span>
<span style="color: #928374;">;; </span><span style="color: #928374;">Evaluation took:</span>
<span style="color: #928374;">;;   </span><span style="color: #928374;">0.156 seconds of real time</span>
<span style="color: #928374;">;;   </span><span style="color: #928374;">0.154420 seconds of total run time (0.154420 user, 0.000000 system)</span>
<span style="color: #928374;">;;   </span><span style="color: #928374;">98.72% CPU</span>
<span style="color: #928374;">;;   </span><span style="color: #928374;">385,821,252 processor cycles</span>
<span style="color: #928374;">;;   </span><span style="color: #928374;">1,280,048 bytes consed</span>

<span style="color: #928374;">;; </span><span style="color: #928374;">10 (4 bits, #xA, #o12, #b1010)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orged29daa" class="outline-3">
<h3 id="orged29daa">2d transformation matrices</h3>
<div class="outline-text-3" id="text-orged29daa">
<p>
<a href="/2d_transformations.html#1685671420">linearly mapping a grid to another</a>:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp" id="src-map-grid"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">map-grid-matrix</span> <span style="color: #837486;">(</span>src-x-range dest-x-range src-y-range dest-y-range<span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #9C6F68;">(</span><span style="color: #7B665C;">(</span>src-x-min <span style="color: #5C7E81;">(</span>elt src-x-range 0<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
        <span style="color: #7B665C;">(</span>dest-x-min <span style="color: #5C7E81;">(</span>elt dest-x-range 0<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
        <span style="color: #7B665C;">(</span>src-y-min <span style="color: #5C7E81;">(</span>elt src-y-range 0<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
        <span style="color: #7B665C;">(</span>dest-y-min <span style="color: #5C7E81;">(</span>elt dest-y-range 0<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
        <span style="color: #7B665C;">(</span>src-x-max <span style="color: #5C7E81;">(</span>elt src-x-range 1<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
        <span style="color: #7B665C;">(</span>dest-x-max <span style="color: #5C7E81;">(</span>elt dest-x-range 1<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
        <span style="color: #7B665C;">(</span>src-y-max <span style="color: #5C7E81;">(</span>elt src-y-range 1<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
        <span style="color: #7B665C;">(</span>dest-y-max <span style="color: #5C7E81;">(</span>elt dest-y-range 1<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
    <span style="color: #9C6F68;">(</span>make-array
     '<span style="color: #7B665C;">(</span>3 3<span style="color: #7B665C;">)</span>
     <span style="color: #FE8019;">:initial-contents</span>
     `<span style="color: #7B665C;">(</span><span style="color: #5C7E81;">(</span>,<span style="color: #837486;">(</span>/ <span style="color: #9C6F68;">(</span>- dest-x-max dest-x-min<span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>- src-x-max src-x-min<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span> 0 ,<span style="color: #837486;">(</span>/ <span style="color: #9C6F68;">(</span>+ <span style="color: #7B665C;">(</span>* <span style="color: #5C7E81;">(</span>- src-x-min<span style="color: #5C7E81;">)</span> dest-x-max<span style="color: #7B665C;">)</span> <span style="color: #7B665C;">(</span>* dest-x-min src-x-max<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>- src-x-max src-x-min<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
       <span style="color: #5C7E81;">(</span>0 ,<span style="color: #837486;">(</span>/ <span style="color: #9C6F68;">(</span>- dest-y-max dest-y-min<span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>- src-y-max src-y-min<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span> ,<span style="color: #837486;">(</span>/ <span style="color: #9C6F68;">(</span>+ <span style="color: #7B665C;">(</span>* <span style="color: #5C7E81;">(</span>- src-y-min<span style="color: #5C7E81;">)</span> dest-y-max<span style="color: #7B665C;">)</span> <span style="color: #7B665C;">(</span>* dest-y-min src-y-max<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>- src-y-max src-y-min<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
       <span style="color: #5C7E81;">(</span>0 0 1<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">map-grid</span> <span style="color: #837486;">(</span>mat src-x-range dest-x-range src-y-range dest-y-range<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"apply the grid mapping matrix and return a new matrix"</span>
  <span style="color: #837486;">(</span>matrix-mul
   <span style="color: #9C6F68;">(</span>map-grid-matrix src-x-range dest-x-range src-y-range dest-y-range<span style="color: #9C6F68;">)</span>
   mat<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
example usage:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>matrix-mul <span style="color: #837486;">(</span>map-grid-matrix '<span style="color: #9C6F68;">(</span>-1 1<span style="color: #9C6F68;">)</span> '<span style="color: #9C6F68;">(</span>0 10<span style="color: #9C6F68;">)</span> '<span style="color: #9C6F68;">(</span>0 1<span style="color: #9C6F68;">)</span> '<span style="color: #9C6F68;">(</span>0 -10<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span> #2A<span style="color: #837486;">(</span><span style="color: #9C6F68;">(</span>0.5<span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>0.5<span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>1<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<pre class="example">
#2A((7.5) (-5.0) (1.0))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgea380e9" class="outline-2">
<h2 id="orgea380e9"><a href="/linearly_mapping_an_interval_onto_another.html#1686235443">linearly mapping discrete range onto another</a></h2>
<div class="outline-text-2" id="text-orgea380e9">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp" id="src-map-num"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">map-num</span> <span style="color: #837486;">(</span>num src-min src-max dest-min dest-max<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"(map-num 0.5 -1 1 -50 50) =&gt; 25.0"</span>
  <span style="color: #837486;">(</span>/ <span style="color: #9C6F68;">(</span>- <span style="color: #7B665C;">(</span>+ <span style="color: #5C7E81;">(</span>* <span style="color: #837486;">(</span>- num src-min<span style="color: #837486;">)</span> <span style="color: #837486;">(</span>- dest-max dest-min<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #5C7E81;">(</span>* dest-min src-max<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span> <span style="color: #7B665C;">(</span>* dest-min src-min<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>- src-max src-min<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org65bbe55" class="outline-2">
<h2 id="org65bbe55">sets</h2>
<div class="outline-text-2" id="text-org65bbe55">
<p>
a good resource <a href="https://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node152.html">https://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node152.html</a><br />
the builtin <code>set-difference</code> sometimes reverses the lists it returns for some reason and its bothersome, e.g.:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>set-difference '<span style="color: #837486;">(</span>K P N A D<span style="color: #837486;">)</span> '<span style="color: #837486;">(</span>K P<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">; =&gt; (D A N)</span>
</pre>
</div>
<p>
so i had to use my own:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp" id="src-set-diff"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">set-diff</span> <span style="color: #837486;">(</span>l1 l2 <span style="color: #66999D;">&amp;key</span> <span style="color: #9C6F68;">(</span>acc '<span style="color: #7B665C;">()</span><span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>test #'eql<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">cond</span> <span style="color: #9C6F68;">(</span><span style="color: #7B665C;">(</span>null l1<span style="color: #7B665C;">)</span> <span style="color: #7B665C;">(</span>nreverse acc<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
        <span style="color: #9C6F68;">(</span><span style="color: #7B665C;">(</span>null l2<span style="color: #7B665C;">)</span> <span style="color: #7B665C;">(</span>nreverse <span style="color: #5C7E81;">(</span>append <span style="color: #837486;">(</span>reverse l1<span style="color: #837486;">)</span> acc<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
        <span style="color: #9C6F68;">(</span><span style="color: #7B665C;">(</span>member <span style="color: #5C7E81;">(</span>car l1<span style="color: #5C7E81;">)</span> l2 <span style="color: #FE8019;">:test</span> test<span style="color: #7B665C;">)</span> <span style="color: #7B665C;">(</span>set-diff <span style="color: #5C7E81;">(</span>cdr l1<span style="color: #5C7E81;">)</span> l2 <span style="color: #FE8019;">:acc</span> acc <span style="color: #FE8019;">:test</span> test<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
        <span style="color: #9C6F68;">(</span>t <span style="color: #7B665C;">(</span>set-diff <span style="color: #5C7E81;">(</span>cdr l1<span style="color: #5C7E81;">)</span> l2 <span style="color: #FE8019;">:acc</span> <span style="color: #5C7E81;">(</span>cons <span style="color: #837486;">(</span>car l1<span style="color: #837486;">)</span> acc<span style="color: #5C7E81;">)</span> <span style="color: #FE8019;">:test</span> test<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
example:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>set-diff '<span style="color: #837486;">(</span>K P N A D<span style="color: #837486;">)</span> '<span style="color: #837486;">(</span>K P<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">; =&gt; (N A D)</span>
</pre>
</div>
<p>
a function to check whether a list is a <a href="/subset.html#1707154240">subset</a> of another, with the <code>test</code> being <code>:equal</code><br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">subset?</span> <span style="color: #837486;">(</span>list1 list2<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"check if improper subset with test `</span><span style="color: #BBAA97;">equal</span><span style="color: #528B8B;">', shorthand for `</span><span style="color: #BBAA97;">subsetp</span><span style="color: #528B8B;">'</span>
<span style="color: #528B8B;">consider the difference:</span>
<span style="color: #528B8B;">CL-USER&gt; (subsetp '((1) (2)) '((1) (2)))</span>
<span style="color: #528B8B;">NIL</span>
<span style="color: #528B8B;">CL-USER&gt; (subset? '((1) (2)) '((1) (2)))</span>
<span style="color: #528B8B;">T"</span>
  <span style="color: #837486;">(</span>subsetp list1 list2 <span style="color: #FE8019;">:test</span> #'equal<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
check for set equality:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">set-equal?</span> <span style="color: #837486;">(</span>list1 list2<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"the 'mathematical' way of doing it, lol, could've used `</span><span style="color: #BBAA97;">set-exclusive-or</span><span style="color: #528B8B;">'"</span>
  <span style="color: #837486;">(</span>and <span style="color: #9C6F68;">(</span>subset? list1 list2<span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>subset? list2 list1<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org80f0481" class="outline-2">
<h2 id="org80f0481">combinatorics</h2>
<div class="outline-text-2" id="text-org80f0481">
<p>
generating variations:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">variations</span> <span style="color: #837486;">(</span>seq <span style="color: #66999D;">&amp;optional</span> <span style="color: #9C6F68;">(</span>len <span style="color: #7B665C;">(</span>length seq<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"get all variations of a sequence, order matters, repetition isnt allowed"</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">if</span> <span style="color: #9C6F68;">(</span>equal len 1<span style="color: #9C6F68;">)</span>
      <span style="color: #9C6F68;">(</span>seq-singletons seq<span style="color: #9C6F68;">)</span>
      <span style="color: #9C6F68;">(</span>apply
       #'append
       <span style="color: #7B665C;">(</span><span style="color: #DD6F48;">loop</span> for i from 0 below <span style="color: #5C7E81;">(</span>length seq<span style="color: #5C7E81;">)</span>
             collect <span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #837486;">(</span><span style="color: #9C6F68;">(</span>subvariations <span style="color: #7B665C;">(</span>variations <span style="color: #5C7E81;">(</span>remove-nth seq i<span style="color: #5C7E81;">)</span> <span style="color: #5C7E81;">(</span>1- len<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
                       <span style="color: #837486;">(</span><span style="color: #DD6F48;">loop</span> for variation in subvariations
                             collect <span style="color: #9C6F68;">(</span>concatenate-type-aware
                                      <span style="color: #7B665C;">(</span>list <span style="color: #5C7E81;">(</span>subseq seq i <span style="color: #5C7E81;">(</span>1+ i<span style="color: #5C7E81;">)</span><span style="color: #5C7E81;">)</span> variation<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">variations-upto-length</span> <span style="color: #837486;">(</span>seq <span style="color: #66999D;">&amp;optional</span> <span style="color: #9C6F68;">(</span>len <span style="color: #7B665C;">(</span>length seq<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>apply #'append
         <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">loop</span> for i from 1 upto len
               collect <span style="color: #7B665C;">(</span>variations seq i<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
generating variations with repetition:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">variations-with-repetition</span> <span style="color: #837486;">(</span>seq <span style="color: #66999D;">&amp;optional</span> <span style="color: #9C6F68;">(</span>len <span style="color: #7B665C;">(</span>length seq<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"generate all variations of the sequence `</span><span style="color: #BBAA97;">seq</span><span style="color: #528B8B;">' of length `</span><span style="color: #BBAA97;">len</span><span style="color: #528B8B;">', such that repetition is allowed, returns a list of sequences of length (length(seq)+1)^len"</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #9C6F68;">(</span><span style="color: #7B665C;">(</span>singletons <span style="color: #5C7E81;">(</span>map 'list <span style="color: #837486;">(</span>seq-type seq<span style="color: #837486;">)</span> seq<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">construct a singleton (one element sequences) from every element</span>
    <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">if</span> <span style="color: #7B665C;">(</span>equal len 1<span style="color: #7B665C;">)</span>
        singletons
        <span style="color: #7B665C;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #5C7E81;">(</span><span style="color: #837486;">(</span>variations <span style="color: #9C6F68;">(</span>variations-with-repetition seq <span style="color: #7B665C;">(</span>1- len<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
          <span style="color: #5C7E81;">(</span>concatenate-type-aware 
           <span style="color: #837486;">(</span><span style="color: #DD6F48;">loop</span> for variation in variations
                 collect <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">loop</span> for singleton in singletons
                               collect <span style="color: #7B665C;">(</span>concatenate-type-aware
                                        <span style="color: #5C7E81;">(</span>list singleton variation<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">variations-with-repetition-upto-length</span> <span style="color: #837486;">(</span>seq len<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"generate all variations of the sequence `</span><span style="color: #BBAA97;">seq</span><span style="color: #528B8B;">' of lengths 1 to `</span><span style="color: #BBAA97;">len</span><span style="color: #528B8B;">', such that repetition is allowed, returns a list of sequences"</span>
  <span style="color: #837486;">(</span>concatenate-type-aware 
   <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">loop</span> for i from 1 upto len
         collect <span style="color: #7B665C;">(</span>variations-with-repetition seq i<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
generating combinations:<br />
to make the problem easier to tackle i took some examples:<br />
assume the sequence "ashey" and the length 3, the base case for <a href="/recursive_algorithm.html#1667600200">recursion</a> would be a sequence of length 3, so if we were to progress letter by letter through the sequence we'd get to a function call with the sequence "hey" and the length 3, then when we exit recursion calls back to the call with the sequence "shey", we need to consider the cell "s" with 3 other sequences, "he","hy","ey", which itself is a combination with the sequence "hey" and length 2, so a call to the function should take care of getting the combinations of the subsequences its concatenating which requires a recursive call to the function by with a reduced length and a reduced subsequence, we may use this as a base case, so when we get a length of 2 we return every combination of length 2, this will satisfy the call with the sequence "hey" and length 3 which in turn satisfies the call with the sequence "shey" and length 4, and so on..<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">combinations</span> <span style="color: #837486;">(</span>seq len<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"generate all combinations of the sequence `</span><span style="color: #BBAA97;">seq</span><span style="color: #528B8B;">' of length `</span><span style="color: #BBAA97;">len</span><span style="color: #528B8B;">', such that repetition is allowed and order doesnt matter, returns a list of sequences of length binom{length(seq)}{len}"</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">if</span> <span style="color: #9C6F68;">(</span>&gt;= len <span style="color: #7B665C;">(</span>length seq<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
      <span style="color: #9C6F68;">(</span>list seq<span style="color: #9C6F68;">)</span>
      <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">if</span> <span style="color: #7B665C;">(</span>equal len 1<span style="color: #7B665C;">)</span>
          <span style="color: #7B665C;">(</span>seq-singletons seq<span style="color: #7B665C;">)</span>
          <span style="color: #7B665C;">(</span><span style="color: #DD6F48;">if</span> <span style="color: #5C7E81;">(</span>equal len 2<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">is this "base case" necessary?</span>
              <span style="color: #5C7E81;">(</span>concatenate-type-aware
               <span style="color: #837486;">(</span><span style="color: #DD6F48;">loop</span> for i from 0 below <span style="color: #9C6F68;">(</span>length seq<span style="color: #9C6F68;">)</span>
                     collect <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">loop</span> for j from <span style="color: #7B665C;">(</span>1+ i<span style="color: #7B665C;">)</span> below <span style="color: #7B665C;">(</span>length seq<span style="color: #7B665C;">)</span>
                                   collect <span style="color: #7B665C;">(</span>concatenate-type-aware
                                            <span style="color: #5C7E81;">(</span>list <span style="color: #5C7E81;">(</span>subseq seq i <span style="color: #837486;">(</span>1+ i<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
                                                  <span style="color: #5C7E81;">(</span>subseq seq j <span style="color: #837486;">(</span>1+ j<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
              <span style="color: #5C7E81;">(</span>concatenate-type-aware
               <span style="color: #837486;">(</span><span style="color: #DD6F48;">loop</span> for i from 0 upto <span style="color: #9C6F68;">(</span>- <span style="color: #7B665C;">(</span>length seq<span style="color: #7B665C;">)</span> len<span style="color: #9C6F68;">)</span>
                     collect <span style="color: #9C6F68;">(</span>map 'list
                                  <span style="color: #7B665C;">(</span><span style="color: #DD6F48;">lambda</span> <span style="color: #5C7E81;">(</span>subcombination<span style="color: #5C7E81;">)</span>
                                    <span style="color: #5C7E81;">(</span>concatenate-type-aware
                                     <span style="color: #5C7E81;">(</span>list <span style="color: #837486;">(</span>subseq seq i <span style="color: #9C6F68;">(</span>1+ i<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span> subcombination<span style="color: #5C7E81;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
                                  <span style="color: #7B665C;">(</span>combinations <span style="color: #5C7E81;">(</span>subseq seq <span style="color: #5C7E81;">(</span>1+ i<span style="color: #5C7E81;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #5C7E81;">(</span>1- len<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>

<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">combinations-upto-length</span> <span style="color: #837486;">(</span>seq <span style="color: #66999D;">&amp;optional</span> <span style="color: #9C6F68;">(</span>max-len <span style="color: #7B665C;">(</span>length seq<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"generate all combinations of the sequence `</span><span style="color: #BBAA97;">seq</span><span style="color: #528B8B;">' of lengths 1 to `</span><span style="color: #BBAA97;">max-len</span><span style="color: #528B8B;">', such that repetition is allowed and order doesnt matter, returns a list of sequences"</span>
  <span style="color: #837486;">(</span>concatenate-type-aware
   <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">loop</span> for i from 1 upto max-len
         collect <span style="color: #7B665C;">(</span>combinations seq i<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
</div>
</body>
</html>
