<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="mahmood sheikh" />
<meta name="generator" content="Org Mode" />
<title>common lisp</title><!-- lambda icon, frail attempt -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%221em%22 font-size=%22100%22 color=%22red%22>λ</text></svg>">
<!-- not-so-awesome awesome font -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="/main.css">
<!-- for dark mode -->
<script src="darkmode.js"></script>
<script src="search.js"></script>
<script src="main.js"></script>
</head>
<body>
<div id="preamble" class="status">
<div class="navbar">
  <a href='/'>home</a>
  <a href='/blog.html'>blog</a>
  <a href='/search.html'>search</a>
  <a href='/about.html'>about</a>
  <div id="darkModeToggle" onclick="toggleDarkMode()">
    &#9680; <!-- Circle with left half black -->
  </div>
</div><h1 class="main-title">common lisp</h1>
</div>
<div id="content" class="content">
<div id="outline-container-org1e835b9" class="outline-2">
<h2 id="org1e835b9">for loop</h2>
<div class="outline-text-2" id="text-org1e835b9">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">loop</span> for x in '<span style="color: #837486;">(</span>1 2 3<span style="color: #837486;">)</span>
      collect x<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">returns list</span>
<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">loop</span> for x in '<span style="color: #837486;">(</span>1 2 3<span style="color: #837486;">)</span>
      do <span style="color: #837486;">(</span>print x<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">prints the numbers</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org563de24" class="outline-2">
<h2 id="org563de24">functions</h2>
<div class="outline-text-2" id="text-org563de24">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">&lt;name&gt;</span> <span style="color: #837486;">(</span>list of arguments<span style="color: #837486;">)</span>
  <span style="color: #528B8B;">"docstring"</span>
  <span style="color: #837486;">(</span>body<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org10091dd" class="outline-2">
<h2 id="org10091dd">plist</h2>
<div class="outline-text-2" id="text-org10091dd">
<p>
defining a plist<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>setf my-plist '<span style="color: #837486;">(</span>alt <span style="color: #528B8B;">"yes"</span> bar <span style="color: #528B8B;">"no"</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
retrieve a value by key<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>getf my-plist 'alt<span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
change the value that corresponds to a key<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>setf <span style="color: #837486;">(</span>getf my-plist 'alt<span style="color: #837486;">)</span> 45<span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
get a list of the attributes<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">loop</span> for <span style="color: #837486;">(</span>key value<span style="color: #837486;">)</span> on my-plist by #'cddr
      collect key<span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5d0ed81" class="outline-2">
<h2 id="org5d0ed81">unbind variable</h2>
<div class="outline-text-2" id="text-org5d0ed81">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>makunbound 'foo<span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf0e10aa" class="outline-2">
<h2 id="orgf0e10aa">undefine funciton</h2>
<div class="outline-text-2" id="text-orgf0e10aa">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>fmakunbound 'function<span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5133259" class="outline-2">
<h2 id="org5133259">quicklisp</h2>
<div class="outline-text-2" id="text-org5133259">
<p>
need to install it manually afaik<br />
</p>
<div class="org-src-container" data-language="bash">
<pre class="src src-bash">curl -O https://beta.quicklisp.org/quicklisp.lisp
sbcl --load quicklisp.lisp
</pre>
</div>
<p>
then in sbcl<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>quicklisp-quickstart:install <span style="color: #FE8019;">:path</span> <span style="color: #528B8B;">"~/.quicklisp"</span><span style="color: #5C7E81;">)</span>
<span style="color: #5C7E81;">(</span>ql:add-to-init-file<span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
then to install a package in sbcl:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>ql:quickload <span style="color: #528B8B;">"cl-csv"</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
this will install the package if it doesnt exist, and if it exists it just loads it<br />
</p>
</div>
</div>
<div id="outline-container-org4582ecd" class="outline-2">
<h2 id="org4582ecd">classes</h2>
<div class="outline-text-2" id="text-org4582ecd">
<p>
example class:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defclass</span> <span style="color: #66999D;">my-class</span> <span style="color: #837486;">()</span>
  <span style="color: #837486;">(</span><span style="color: #9C6F68;">(</span>property1 <span style="color: #FE8019;">:accessor</span> property1-accessor<span style="color: #9C6F68;">)</span>
   <span style="color: #9C6F68;">(</span>property2 <span style="color: #FE8019;">:accessor</span> property2-accessor<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<p>
the <code>accessor</code> is the name you use to access a property1<br />
we construct an object using <code>make-instance</code>:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defvar</span> <span style="color: #83A598;">p1</span> <span style="color: #837486;">(</span>make-instance 'my-class<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<p>
we can initialize the class with specific values, first we need to use the <code>:initarg</code> keyword on the class properties<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defclass</span> <span style="color: #66999D;">my-class</span> <span style="color: #837486;">()</span>
  <span style="color: #837486;">(</span><span style="color: #9C6F68;">(</span>property1 <span style="color: #FE8019;">:initarg</span> property1-initarg <span style="color: #FE8019;">:initform</span> default-value <span style="color: #FE8019;">:accessor</span> property1-accessor<span style="color: #9C6F68;">)</span>
   <span style="color: #9C6F68;">(</span>property2 <span style="color: #FE8019;">:accessor</span> property2-accessor<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<p>
then we can pass the values we want to <code>make-instance</code><br />
<code>:initform</code> is used to pass a default value to the slot incase <code>:initarg</code> argument isnt passed to <code>make-instance</code><br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defvar</span> <span style="color: #83A598;">p1</span> <span style="color: #837486;">(</span>make-instance 'my-class <span style="color: #FE8019;">:property1-initarg</span> property1-value<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<p>
this is the syntax for accessing variables of a class<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>property1-accessor p1<span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
we can do inheritance by passing the parent class in the parenthases after the class name:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defclass</span> <span style="color: #66999D;">my-class</span> <span style="color: #837486;">(</span>my-parent-class<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
the following syntax is used to define a function for a class, note that the function <code>print-object</code> is the function that gets called when trying to print an object using <code>(print object)</code> so thats what we're defining here<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defmethod</span> <span style="color: #A89984;">print-object</span> <span style="color: #837486;">(</span><span style="color: #9C6F68;">(</span>obj my-class<span style="color: #9C6F68;">)</span> stream<span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>print-unreadable-object <span style="color: #9C6F68;">(</span>obj stream <span style="color: #FE8019;">:type</span> t<span style="color: #9C6F68;">)</span>
    <span style="color: #9C6F68;">(</span>format stream <span style="color: #528B8B;">"value of property1: ~a"</span> <span style="color: #7B665C;">(</span>property1 obj<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org6652ccc" class="outline-2">
<h2 id="org6652ccc">structs</h2>
<div class="outline-text-2" id="text-org6652ccc">
<p>
structs are basically simpler classes with default functions/initializers/etc<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defstruct</span> <span style="color: #66999D;">rgb</span> <span style="color: #837486;">()</span>
           <span style="color: #837486;">(</span>r 0<span style="color: #837486;">)</span> <span style="color: #837486;">(</span>g 0<span style="color: #837486;">)</span> <span style="color: #837486;">(</span>b 0<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">initialize slot values to 0</span>

<span style="color: #928374;">;; </span><span style="color: #928374;">e.g. constructor built by default</span>
<span style="color: #5C7E81;">(</span>setf color <span style="color: #837486;">(</span>make-rgb <span style="color: #FE8019;">:r</span> 2<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; #S(RGB :NIL NIL :R 2 :G 0 :B 0)</span>

<span style="color: #5C7E81;">(</span>list <span style="color: #837486;">(</span>rgb-r color<span style="color: #837486;">)</span> <span style="color: #837486;">(</span>rgb-b color<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; (2 0)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgce09f4d" class="outline-2">
<h2 id="orgce09f4d">arrays/matrices</h2>
<div class="outline-text-2" id="text-orgce09f4d">
<p>
to create an array:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>make-array 10 <span style="color: #FE8019;">:initial-element</span> 10<span style="color: #5C7E81;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
</tr>
</tbody>
</table>

<p>
multidimensional arrays:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>make-array '<span style="color: #837486;">(</span>4 3<span style="color: #837486;">)</span> <span style="color: #FE8019;">:initial-element</span> 15<span style="color: #5C7E81;">)</span>
</pre>
</div>

<pre class="example">
#2A((15 15 15) (15 15 15) (15 15 15) (15 15 15))
</pre>


<p>
access slot in array<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>aref <span style="color: #837486;">(</span>make-array '<span style="color: #9C6F68;">(</span>4 3 1<span style="color: #9C6F68;">)</span> <span style="color: #FE8019;">:initial-element</span> 15<span style="color: #837486;">)</span> 2 0 0<span style="color: #5C7E81;">)</span>
</pre>
</div>

<pre class="example">
15
</pre>


<p>
get the length of the array (last argument is the dimension to check length of):<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>print <span style="color: #837486;">(</span>array-dimension <span style="color: #9C6F68;">(</span>make-array '<span style="color: #7B665C;">(</span>4 3<span style="color: #7B665C;">)</span> <span style="color: #FE8019;">:initial-element</span> 15<span style="color: #9C6F68;">)</span> 0<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
<span style="color: #5C7E81;">(</span>print <span style="color: #837486;">(</span>array-dimension <span style="color: #9C6F68;">(</span>make-array '<span style="color: #7B665C;">(</span>4 3<span style="color: #7B665C;">)</span> <span style="color: #FE8019;">:initial-element</span> 15<span style="color: #9C6F68;">)</span> 1<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<pre class="example">

4 
3 
</pre>


<p>
iterate through array:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>map nil #'print <span style="color: #837486;">(</span>make-array 3 <span style="color: #FE8019;">:initial-element</span> 15<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<pre class="example">

15 
15 
15 
</pre>


<p>
iterate with index:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #837486;">(</span><span style="color: #9C6F68;">(</span>arr <span style="color: #7B665C;">(</span>make-array '<span style="color: #5C7E81;">(</span>4 3<span style="color: #5C7E81;">)</span> <span style="color: #FE8019;">:initial-element</span> 15<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span><span style="color: #DD6F48;">loop</span> for i from 0 below <span style="color: #9C6F68;">(</span>array-dimension arr 0<span style="color: #9C6F68;">)</span>
    do <span style="color: #9C6F68;">(</span>print <span style="color: #7B665C;">(</span>aref arr i 1<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<pre class="example">

15 
15 
15 
15 
</pre>


<p>
use displacement arrays to get the first element of every row in a 2d array:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">loop</span> for i from 0 below <span style="color: #837486;">(</span>array-dimension arr 0<span style="color: #837486;">)</span>
      collect <span style="color: #837486;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #9C6F68;">(</span><span style="color: #7B665C;">(</span>row <span style="color: #5C7E81;">(</span>make-array
                          <span style="color: #837486;">(</span>array-dimension arr 1<span style="color: #837486;">)</span>
                          <span style="color: #FE8019;">:displaced-to</span> arr
                          <span style="color: #FE8019;">:displaced-index-offset</span> <span style="color: #837486;">(</span>* i <span style="color: #9C6F68;">(</span>array-dimension arr 1<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
                <span style="color: #9C6F68;">(</span>aref row 0<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<p>
we can create resizable arrays with the <code>:adjustable</code> keyword, <code>:fill-pointer</code> denotes the next position to be filled in the array and is automatically maintained by the array itself, but has to be initialized<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defparameter</span> <span style="color: #83A598;">*x*</span> <span style="color: #837486;">(</span>make-array 0 <span style="color: #FE8019;">:adjustable</span> t <span style="color: #FE8019;">:fill-pointer</span> 0<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
<span style="color: #5C7E81;">(</span>vector-push-extend 'a *x*<span style="color: #5C7E81;">)</span>
<span style="color: #5C7E81;">(</span>vector-push-extend 'b *x*<span style="color: #5C7E81;">)</span>
*x*
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">A</td>
<td class="org-left">B</td>
</tr>
</tbody>
</table>

<p>
fill array manually:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>make-array '<span style="color: #837486;">(</span>3 3<span style="color: #837486;">)</span> <span style="color: #FE8019;">:initial-contents</span> '<span style="color: #837486;">(</span><span style="color: #9C6F68;">(</span>1 0 0<span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>0 1 0<span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>0 0 1<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org917e69c" class="outline-2">
<h2 id="org917e69c">vectors</h2>
<div class="outline-text-2" id="text-org917e69c">
<p>
create vector<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>vector 3 5 1<span style="color: #5C7E81;">)</span>
</pre>
</div>

<p>
we can use <code>length</code> on vectors<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>length <span style="color: #837486;">(</span>vector 3 5 1<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> ==&gt; 3
</pre>
</div>

<p>
get nth element:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defparameter</span> <span style="color: #83A598;">*x*</span> <span style="color: #837486;">(</span>vector 1 2 3<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
<span style="color: #5C7E81;">(</span>length *x*<span style="color: #5C7E81;">)</span> ==&gt; 3
<span style="color: #5C7E81;">(</span>elt *x* 1<span style="color: #5C7E81;">)</span>  ==&gt; 2
</pre>
</div>

<p>
we can have nested vectors<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #837486;">(</span><span style="color: #9C6F68;">(</span>a <span style="color: #7B665C;">(</span>vector <span style="color: #5C7E81;">(</span>vector 1 2<span style="color: #5C7E81;">)</span> <span style="color: #5C7E81;">(</span>vector 3<span style="color: #5C7E81;">)</span> 4<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>print a<span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>print <span style="color: #9C6F68;">(</span>elt a 0<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<pre class="example">

#(#(1 2) #(3) 4) 
#(1 2) 
</pre>
</div>
</div>
<div id="outline-container-orgc65e650" class="outline-2">
<h2 id="orgc65e650">multithreading</h2>
<div class="outline-text-2" id="text-orgc65e650">
<p>
in sbcl <code>sb-thread:make-thread</code> takes a function to call in a newly created thread.<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>sb-thread:make-thread
 <span style="color: #837486;">(</span><span style="color: #DD6F48;">lambda</span> <span style="color: #9C6F68;">()</span>
   <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">progn</span>
     <span style="color: #7B665C;">(</span>sleep 0<span style="color: #7B665C;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">give other threads a chance to run, then return here</span>
     <span style="color: #7B665C;">(</span>setf c <span style="color: #5C7E81;">(</span>+ a b<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span>
     <span style="color: #7B665C;">(</span>print <span style="color: #528B8B;">"ADDITION:"</span><span style="color: #7B665C;">)</span>
     <span style="color: #7B665C;">(</span>print c<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
although notice that this is special to sbcl.<br />
the <a href="https://github.com/lmj/lparallel">lparallel</a> library works great on multiple CL implementations, more on lparallel at <a href="https://lparallel.org/page/2/">https://lparallel.org/page/2/</a><br />
</p>
</div>
</div>
<div id="outline-container-orgb2818b8" class="outline-2">
<h2 id="orgb2818b8">macros</h2>
<div class="outline-text-2" id="text-orgb2818b8">
<p>
simple macro from <a href="https://lispcookbook.github.io/cl-cookbook/macros.html">https://lispcookbook.github.io/cl-cookbook/macros.html</a>:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defmacro</span> <span style="color: #A89984;">setq2</span> <span style="color: #837486;">(</span>v1 v2 e<span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>list 'progn <span style="color: #9C6F68;">(</span>list 'setq v1 e<span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>list 'setq v2 e<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
<span style="color: #928374;">;; </span><span style="color: #928374;">(setq2 v1 v2 3) =&gt; v1=3,v2=3</span>
</pre>
</div>
<p>
this macro is very close to the following function definition:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">setq2-function</span> <span style="color: #837486;">(</span>v1 v2 e<span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>list 'progn <span style="color: #9C6F68;">(</span>list 'setq v1 e<span style="color: #9C6F68;">)</span> <span style="color: #9C6F68;">(</span>list 'setq v2 e<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
consider the following macro <code>when2</code> which behaves like the builtin <code>when</code><br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defmacro</span> <span style="color: #A89984;">when2</span> <span style="color: #837486;">(</span>condition <span style="color: #66999D;">&amp;rest</span> body<span style="color: #837486;">)</span>
  `<span style="color: #837486;">(</span><span style="color: #DD6F48;">if</span> ,condition <span style="color: #9C6F68;">(</span><span style="color: #DD6F48;">progn</span> ,@body<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
<span style="color: #928374;">;; </span><span style="color: #928374;">(when2 t (print "hey")) =&gt; "hey"</span>
<span style="color: #928374;">;; </span><span style="color: #928374;">(when2 nil (print "hey")) =&gt; nothing</span>
</pre>
</div>
<div class="math-block note" data-before="note" data-after="">
<p>
from <a href="http://www.lispworks.com/documentation/HyperSpec/Body/02_df.htm">http://www.lispworks.com/documentation/HyperSpec/Body/02_df.htm</a><br />
if a comma is immediately followed by an at-sign, then the form following the at-sign is evaluated to produce a list of objects. these objects are then “spliced” into place in the template. for example, if x has the value (a b c), then<br />
 `(x ,x ,@x foo ,(cadr x) bar ,(cdr x) baz ,@(cdr x))<br />
=&gt;  (x (a b c) a b c foo b bar (b c) baz b c)<br />
</p>

</div>
<p>
<code>body</code> is just a list and can be used/modified<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defmacro</span> <span style="color: #A89984;">test-macro</span> <span style="color: #837486;">(</span><span style="color: #66999D;">&amp;rest</span> body<span style="color: #837486;">)</span>
  `<span style="color: #837486;">(</span>quote ,body<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
this is called an <b>anaphoric macro</b> where you wrap the body with a lexical function definition that shadows the global one<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp">CL-USER&gt; <span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">foo</span> <span style="color: #837486;">()</span> 1<span style="color: #5C7E81;">)</span>
FOO
CL-USER&gt; <span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defmacro</span> <span style="color: #A89984;">with-different-foo</span> <span style="color: #837486;">(</span><span style="color: #66999D;">&amp;body</span> body<span style="color: #837486;">)</span>
           `<span style="color: #837486;">(</span><span style="color: #DD6F48;">flet</span> <span style="color: #9C6F68;">(</span><span style="color: #7B665C;">(</span>foo <span style="color: #5C7E81;">()</span> 2<span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span>
              ,@body<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
WITH-DIFFERENT-FOO
CL-USER&gt; <span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">progn</span>
           <span style="color: #837486;">(</span>foo<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
1
CL-USER&gt; <span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">with-different-foo</span>
           <span style="color: #837486;">(</span>foo<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
2
</pre>
</div>
</div>
</div>
<div id="outline-container-org67f0956" class="outline-2">
<h2 id="org67f0956">reader macros</h2>
<div class="outline-text-2" id="text-org67f0956">
<p>
the <code>#+</code> and <code>#-</code> <b>reader macros</b> are pretty nice for commenting out sexps. they allow ignoring the following sexp, if the given symbol isn't/is found in <code>*FEATURES*</code>. Just pick a symbol not in <code>*FEATURES*</code>, and use it with <code>#+</code> like this:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp">#+nil
<span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">defun</span> <span style="color: #A89984;">foo</span> <span style="color: #837486;">()</span>
  ...<span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
Now, the function definition will be ignored (unless NIL is in <code>*FEATURES*</code>, which is not very likely).<br />
</p>
</div>
</div>
<div id="outline-container-org2ba0323" class="outline-2">
<h2 id="org2ba0323">use double-floats by default</h2>
<div class="outline-text-2" id="text-org2ba0323">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>setf *read-default-float-format* 'double-float<span style="color: #5C7E81;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org7c9b4c8" class="outline-2">
<h2 id="org7c9b4c8">enforce garbage collection</h2>
<div class="outline-text-2" id="text-org7c9b4c8">
<p>
running<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>gc <span style="color: #FE8019;">:full</span> t<span style="color: #5C7E81;">)</span>
</pre>
</div>
<p>
invokes the garbage collector<br />
</p>
</div>
</div>
<div id="outline-container-orgcb23750" class="outline-2">
<h2 id="orgcb23750">checking equalities</h2>
<div class="outline-text-2" id="text-orgcb23750">
<p>
some equality tests may return results that are implementation-specific, i dont list those here, i only wrote the ones that are supposed to work on any cl implementation<br />
string equality:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>equal <span style="color: #528B8B;">"foo"</span> <span style="color: #837486;">(</span>copy-seq <span style="color: #528B8B;">"foo"</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
</pre>
</div>
<p>
symbol equality (any equality operator works for symbols):<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>eq 'foo 'foo<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
</pre>
</div>
<p>
number equality:<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #928374;">;; </span><span style="color: #928374;">'eql' is "type sensitive"</span>
<span style="color: #5C7E81;">(</span>eql 3 3.0<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; NIL</span>
<span style="color: #5C7E81;">(</span>eql 3 3<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
<span style="color: #928374;">;; </span><span style="color: #928374;">'equal' works for floats and integers all the same</span>
<span style="color: #5C7E81;">(</span>equal 3 3.0<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
<span style="color: #5C7E81;">(</span>equal 3 3<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
<span style="color: #928374;">;; </span><span style="color: #928374;">'equalp' works for floats and integers all the same</span>
<span style="color: #5C7E81;">(</span>equalp 3 3.0<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
<span style="color: #5C7E81;">(</span>equalp 3 3<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
</pre>
</div>
<p>
object equality (same object in memory):<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span>eq 'a 'a<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
<span style="color: #5C7E81;">(</span>eq <span style="color: #528B8B;">"foo"</span> <span style="color: #837486;">(</span>copy-seq <span style="color: #528B8B;">"foo"</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; NIL</span>
<span style="color: #5C7E81;">(</span>eq 3 3.0<span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; NIL</span>
</pre>
</div>
<p>
sequence equality (and general object equality which compares the internal structure):<br />
uppercase and lowercase letters in strings are considered by <code>equal</code> to be distinct. in contrast, <code>equalp</code> ignores case distinctions in strings. <code>equalp</code> works for arrays but <code>equal</code> doesnt ("works" as in does element-wise comparison, which is the intended equality check here)<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #928374;">;; </span><span style="color: #928374;">strings</span>
<span style="color: #5C7E81;">(</span>equal <span style="color: #528B8B;">"Foo"</span> <span style="color: #837486;">(</span>copy-seq <span style="color: #528B8B;">"Foo"</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
<span style="color: #5C7E81;">(</span>equal <span style="color: #528B8B;">"Foo"</span> <span style="color: #837486;">(</span>copy-seq <span style="color: #528B8B;">"foo"</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; NIL</span>
<span style="color: #5C7E81;">(</span>equalp <span style="color: #528B8B;">"Foo"</span> <span style="color: #837486;">(</span>copy-seq <span style="color: #528B8B;">"foo"</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; NIL</span>

<span style="color: #928374;">;; </span><span style="color: #928374;">vectors/arrays</span>
<span style="color: #5C7E81;">(</span>equal #<span style="color: #837486;">(</span>1 2 3<span style="color: #837486;">)</span> <span style="color: #837486;">(</span>copy-seq #<span style="color: #9C6F68;">(</span>1 2 3<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; NIL</span>
<span style="color: #5C7E81;">(</span>equalp #<span style="color: #837486;">(</span>1 2 3<span style="color: #837486;">)</span> <span style="color: #837486;">(</span>copy-seq #<span style="color: #9C6F68;">(</span>1 2 3<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>

<span style="color: #928374;">;; </span><span style="color: #928374;">lists</span>
<span style="color: #5C7E81;">(</span>equal '<span style="color: #837486;">(</span>1 2 3<span style="color: #837486;">)</span> <span style="color: #837486;">(</span>copy-seq '<span style="color: #9C6F68;">(</span>1 2 3<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
<span style="color: #5C7E81;">(</span>equalp '<span style="color: #837486;">(</span>1 2 3<span style="color: #837486;">)</span> <span style="color: #837486;">(</span>copy-seq '<span style="color: #9C6F68;">(</span>1 2 3<span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span> <span style="color: #928374;">;; </span><span style="color: #928374;">=&gt; T</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb51dfeb" class="outline-2">
<h2 id="orgb51dfeb">alist</h2>
<div class="outline-text-2" id="text-orgb51dfeb">
<p>
we can append new pairs to an alist using <code>push</code> (there are many other ways):<br />
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #5C7E81;">(</span><span style="color: #DD6F48;">let</span> <span style="color: #837486;">(</span><span style="color: #9C6F68;">(</span>my-alist '<span style="color: #7B665C;">(</span><span style="color: #5C7E81;">(</span>a . b<span style="color: #5C7E81;">)</span><span style="color: #7B665C;">)</span><span style="color: #9C6F68;">)</span><span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>push <span style="color: #9C6F68;">(</span>cons 'x 'y<span style="color: #9C6F68;">)</span> my-alist<span style="color: #837486;">)</span>
  <span style="color: #837486;">(</span>push '<span style="color: #9C6F68;">(</span>10 . 20<span style="color: #9C6F68;">)</span> my-alist<span style="color: #837486;">)</span><span style="color: #5C7E81;">)</span>
</pre>
</div>

<pre class="example">
((10 . 20) (X . Y) (A . B))
</pre>
</div>
</div>
<div id="outline-container-orgc72ff0e" class="outline-2">
<h2 id="orgc72ff0e">resources</h2>
<div class="outline-text-2" id="text-orgc72ff0e">
<p>
<a href="https://lisp-journey.gitlab.io/blog/common-lisp-macros-by-example-tutorial">https://lisp-journey.gitlab.io/blog/common-lisp-macros-by-example-tutorial</a><br />
<a href="https://taeric.github.io/CodeAsData.html">https://taeric.github.io/CodeAsData.html</a><br />
<a href="https://github.com/ghollisjr/cl-ana">https://github.com/ghollisjr/cl-ana</a><br />
<a href="https://github.com/marcoheisig/Petalisp">https://github.com/marcoheisig/Petalisp</a></p>
</div>
</div>
</div>
</body>
</html>
